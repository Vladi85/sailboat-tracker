<script>
  const map = L.map('map').setView([0, 0], 2);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
  }).addTo(map);

  let marker = L.marker([0, 0]).addTo(map);
  let track = L.polyline([], { color: 'blue' }).addTo(map);
  const infoBox = document.getElementById('info');
  const trackPoints = [];

  async function fetchGPSData() {
    try {
      const response = await fetch('https://io.adafruit.com/Vladi_85/feeds/gps-data/data/last');
      const result = await response.json();
      const payload = JSON.parse(result.value);

      const lat = payload.lat;
      const lon = payload.lon;
      const speed = payload.speed;
      const timestamp = payload.timestamp || new Date().toLocaleTimeString();

      marker.setLatLng([lat, lon]);
      trackPoints.push([lat, lon]);
      track.setLatLngs(trackPoints);
      map.setView([lat, lon], 13);

      infoBox.innerHTML = `Lat: ${lat.toFixed(6)}, Lon: ${lon.toFixed(6)}<br>Speed: ${speed.toFixed(2)} km/h<br>Updated: ${timestamp}`;
    } catch (err) {
      console.error('Failed to fetch GPS data:', err);
    }
  }

  setInterval(fetchGPSData, 5000);
</script>
